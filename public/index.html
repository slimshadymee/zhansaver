<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <title>ZHANSAVER</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #000; --surface: #111; --surface2: #1a1a1a; --border: #2a2a2a;
      --border-active: #fff; --text: #fff; --text-muted: #666; --text-dim: #999;
      --btn-bg: #fff; --btn-text: #000; --danger: #ff3b3b; --success: #3bff8a; --radius: 12px;
    }
    body.light {
      --bg: #f5f5f5; --surface: #fff; --surface2: #efefef; --border: #e0e0e0;
      --border-active: #000; --text: #0a0a0a; --text-muted: #888; --text-dim: #aaa;
      --btn-bg: #0a0a0a; --btn-text: #fff;
    }
    .theme-btn {
      position: fixed; bottom: 20px; right: 20px; z-index: 1000;
      width: 44px; height: 44px; border-radius: 50%;
      background: var(--surface); border: 1.5px solid var(--border);
      color: var(--text); cursor: pointer; font-size: 1.1rem;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 12px rgba(0,0,0,0.3); transition: transform 0.15s, border-color 0.2s;
    }
    .theme-btn:hover { transform: scale(1.1); border-color: var(--border-active); }
    html { font-size: 16px; }
    body { min-height: 100vh; background: var(--bg); font-family: 'Space Mono', monospace; color: var(--text); display: flex; flex-direction: column; align-items: center; -webkit-font-smoothing: antialiased; }

    /* ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ */
    .navbar {
      width: 100%; max-width: 640px;
      display: flex; align-items: center; justify-content: center;
      gap: 4px; padding: 20px 20px 0;
    }
    .nav-btn {
      flex: 1; padding: 10px 0; background: transparent;
      border: 1.5px solid var(--border); border-radius: 10px;
      color: var(--text-muted); font-family: 'Syne', sans-serif; font-weight: 800;
      font-size: 0.78rem; letter-spacing: 0.05em; text-transform: uppercase;
      cursor: pointer; transition: all 0.18s;
    }
    .nav-btn:hover { border-color: #444; color: var(--text); }
    .nav-btn.active { background: var(--btn-bg); color: var(--btn-text); border-color: var(--btn-bg); }

    /* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
    .page { display: none; width: 100%; flex-direction: column; align-items: center; padding-bottom: 60px; }
    .page.active { display: flex; }

    /* ‚îÄ‚îÄ INSTTIK PAGE ‚îÄ‚îÄ */
    .header { width: 100%; max-width: 640px; padding: 32px 20px 0; text-align: center; }
    .logo-mark { width: 44px; height: 44px; border: 2px solid var(--text); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
    .logo-mark svg { display: block; }
    h1 { font-family: 'Syne', sans-serif; font-weight: 800; font-size: clamp(1.6rem, 7vw, 2.2rem); letter-spacing: -0.03em; color: var(--text); line-height: 1; margin-bottom: 8px; }
    .tagline { color: var(--text-muted); font-size: 0.78rem; letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 28px; }
    .site-disabled-banner { width: 100%; margin: 0 auto 16px; padding: 14px 16px; background: rgba(255,59,59,0.1); border: 1.5px solid var(--danger); border-radius: var(--radius); font-size: 0.82rem; color: var(--danger); text-align: center; display: none; }
    .site-disabled-banner.show { display: block; }
    .input-row { display: flex; gap: 8px; width: 100%; }
    .input-group { flex: 1; display: flex; background: var(--surface); border: 1.5px solid var(--border); border-radius: var(--radius); overflow: hidden; transition: border-color 0.2s; }
    .input-group:focus-within { border-color: var(--border-active); }
    input[type="text"] { flex: 1; padding: 14px; background: transparent; border: none; color: var(--text); font-size: 0.875rem; font-family: 'Space Mono', monospace; outline: none; min-width: 0; }
    input[type="text"]::placeholder { color: var(--text-muted); }
    input[type="text"]:disabled { opacity: 0.4; cursor: not-allowed; }
    .btn-paste { padding: 0 14px; background: transparent; border: none; border-left: 1px solid var(--border); color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: color 0.15s, background 0.15s; flex-shrink: 0; }
    .btn-paste:hover { color: var(--text); background: rgba(255,255,255,0.05); }
    .btn-fetch { padding: 14px 20px; background: var(--btn-bg); color: var(--btn-text); border: none; border-radius: var(--radius); font-size: 0.875rem; font-family: 'Syne', sans-serif; font-weight: 800; cursor: pointer; white-space: nowrap; letter-spacing: -0.01em; transition: opacity 0.15s, transform 0.1s; flex-shrink: 0; }
    .btn-fetch:hover { opacity: 0.85; }
    .btn-fetch:active { transform: scale(0.97); }
    .btn-fetch:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }
    .status { width: 100%; max-width: 640px; margin-top: 12px; display: none; }
    .status-inner { padding: 12px 14px; border-radius: var(--radius); font-size: 0.8rem; line-height: 1.5; }
    .status.loading { display: block; }
    .status.loading .status-inner { background: var(--surface); border: 1px solid var(--border); color: var(--text-dim); }
    .status.error { display: block; }
    .status.error .status-inner { background: rgba(255,59,59,0.08); border: 1px solid rgba(255,59,59,0.3); color: var(--danger); }
    .divider { width: calc(100% - 40px); max-width: 640px; height: 1px; background: var(--border); margin: 28px 0; display: none; }
    .divider.show { display: block; }
    .results { width: 100%; max-width: 900px; padding: 0 20px; display: none; }
    .results.show { display: block; }
    .results-header { max-width: 640px; margin: 0 auto 16px; display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
    .results-title { font-size: 0.78rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; }
    .btn-dl-all { display: flex; align-items: center; gap: 6px; padding: 9px 16px; background: var(--btn-bg); color: var(--btn-text); border: none; border-radius: 9px; font-size: 0.8rem; font-family: 'Syne', sans-serif; font-weight: 800; cursor: pointer; transition: opacity 0.15s; }
    .btn-dl-all:hover { opacity: 0.82; }
    .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(min(100%, 240px), 1fr)); gap: 12px; }
    .media-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; transition: border-color 0.2s; }
    .media-card:hover { border-color: #444; }
    .media-thumb { position: relative; aspect-ratio: 1; background: var(--surface2); overflow: hidden; }
    .media-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .media-badge { position: absolute; top: 8px; right: 8px; padding: 3px 8px; background: rgba(0,0,0,0.85); border: 1px solid rgba(255,255,255,0.15); border-radius: 20px; font-size: 0.68rem; font-weight: 700; color: var(--text); letter-spacing: 0.05em; }
    .media-footer { padding: 11px 13px; display: flex; align-items: center; justify-content: space-between; gap: 8px; border-top: 1px solid var(--border); }
    .media-index { font-size: 0.75rem; color: var(--text-muted); }
    .btn-dl { display: flex; align-items: center; gap: 5px; padding: 7px 13px; background: var(--btn-bg); color: var(--btn-text); border: none; border-radius: 8px; font-size: 0.75rem; font-family: 'Syne', sans-serif; font-weight: 800; cursor: pointer; transition: opacity 0.15s; }
    .btn-dl:hover { opacity: 0.8; }
    .btn-dl.done { background: var(--success); color: #000; }
    .single-media { display: flex; flex-direction: column; align-items: center; gap: 16px; }
    .single-media img { max-width: 480px; width: 100%; border-radius: var(--radius); border: 1px solid var(--border); }
    /* –í–∏–¥–µ–æ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—Ç–µ—Ä */
    .single-video { max-width: 480px; width: 100%; border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; background: #000; display: block; cursor: pointer; }

    /* ‚îÄ‚îÄ –ú–û–î–ê–õ–ö–ê –ö–£–ö–ò ‚îÄ‚îÄ */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 1000; align-items: flex-end; justify-content: center; }
    @media (min-width: 480px) { .modal-overlay { align-items: center; padding: 20px; } }
    .modal-overlay.show { display: flex; }
    .modal { background: var(--surface); border: 1px solid var(--border); border-radius: 20px 20px 0 0; padding: 24px 20px; width: 100%; max-width: 560px; max-height: 90vh; overflow-y: auto; }
    @media (min-width: 480px) { .modal { border-radius: 16px; padding: 28px; } }
    .modal-handle { width: 36px; height: 4px; background: var(--border); border-radius: 2px; margin: 0 auto 20px; }
    @media (min-width: 480px) { .modal-handle { display: none; } }
    .modal h2 { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.1rem; margin-bottom: 8px; letter-spacing: -0.02em; }
    .modal p { color: var(--text-muted); font-size: 0.78rem; line-height: 1.7; margin-bottom: 16px; }
    .steps-mini { list-style: none; margin-bottom: 18px; display: flex; flex-direction: column; gap: 6px; }
    .steps-mini li { color: var(--text-dim); font-size: 0.78rem; line-height: 1.6; padding-left: 22px; position: relative; }
    .steps-mini li::before { content: attr(data-n); position: absolute; left: 0; color: var(--text); font-weight: 700; }
    .steps-mini li strong { color: var(--text); }
    textarea { width: 100%; min-height: 80px; background: var(--bg); border: 1.5px solid var(--border); border-radius: var(--radius); color: var(--text); font-size: 0.75rem; padding: 12px; resize: vertical; outline: none; font-family: 'Space Mono', monospace; line-height: 1.5; transition: border-color 0.2s; }
    textarea:focus { border-color: var(--border-active); }
    textarea::placeholder { color: var(--text-muted); }
    .modal-actions { display: flex; gap: 8px; margin-top: 14px; }
    .btn-save { flex: 1; padding: 13px; background: var(--btn-bg); color: var(--btn-text); border: none; border-radius: var(--radius); font-size: 0.9rem; font-family: 'Syne', sans-serif; font-weight: 800; cursor: pointer; transition: opacity 0.15s; }
    .btn-save:hover { opacity: 0.85; }
    .btn-cancel { padding: 13px 18px; background: transparent; color: var(--text-muted); border: 1px solid var(--border); border-radius: var(--radius); font-size: 0.9rem; font-family: 'Space Mono', monospace; cursor: pointer; transition: background 0.15s, color 0.15s; }
    .btn-cancel:hover { background: var(--surface2); color: var(--text); }

    /* ‚îÄ‚îÄ –ú–û–î–ê–õ–ö–ê –î–û–ë–ê–í–ò–¢–¨ –†–ï–õ–ò–ó ‚îÄ‚îÄ */
    .release-form-label { font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 6px; display: block; }
    .release-form-field { margin-bottom: 14px; }
    .release-form-field input[type="text"],
    .release-form-field input[type="date"] { width: 100%; padding: 12px 14px; background: var(--bg); border: 1.5px solid var(--border); border-radius: var(--radius); color: var(--text); font-size: 0.85rem; font-family: 'Space Mono', monospace; outline: none; transition: border-color 0.2s; }
    .release-form-field input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
    .release-form-field input:focus { border-color: var(--border-active); }
    .cover-upload-area { border: 1.5px dashed var(--border); border-radius: var(--radius); padding: 20px; text-align: center; cursor: pointer; transition: border-color 0.2s; position: relative; overflow: hidden; }
    .cover-upload-area:hover { border-color: #555; }
    .cover-upload-area input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
    .cover-upload-area .upload-text { font-size: 0.78rem; color: var(--text-muted); }
    .cover-preview { width: 100%; height: 140px; object-fit: cover; border-radius: 8px; display: none; }
    .cover-tab { flex: 1; padding: 8px; background: transparent; border: 1.5px solid var(--border); border-radius: 8px; color: var(--text-muted); font-family: 'Space Mono', monospace; font-size: 0.72rem; cursor: pointer; transition: all 0.15s; }
    .cover-tab.active { background: var(--btn-bg); color: var(--btn-text); border-color: var(--btn-bg); }

    /* ‚îÄ‚îÄ RELEASE PAGE ‚îÄ‚îÄ */
    .release-page-inner { width: 100%; max-width: 640px; padding: 28px 20px 0; }
    .release-page-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
    .release-page-title { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.4rem; letter-spacing: -0.03em; }
    .btn-add-release { display: flex; align-items: center; gap: 6px; padding: 10px 18px; background: var(--btn-bg); color: var(--btn-text); border: none; border-radius: 10px; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.82rem; cursor: pointer; transition: opacity 0.15s; }
    .btn-add-release:hover { opacity: 0.85; }
    .releases-list { display: flex; flex-direction: column; gap: 12px; }
    .release-card { display: flex; align-items: center; gap: 14px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; padding: 12px 14px; position: relative; transition: border-color 0.2s; }
    .release-card:hover { border-color: #444; }
    .release-card.released { border-color: rgba(59,255,138,0.25); }
    .release-cover { width: 56px; height: 56px; border-radius: 8px; object-fit: cover; background: var(--surface2); flex-shrink: 0; }
    .release-cover-placeholder { width: 56px; height: 56px; border-radius: 8px; background: var(--surface2); flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; }
    .release-info { flex: 1; min-width: 0; }
    .release-title-text { font-family: 'Syne', sans-serif; font-weight: 800; font-size: clamp(0.65rem, 2.5vw, 0.82rem); letter-spacing: -0.02em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.25; }
    .release-artist-text { font-size: clamp(0.6rem, 2vw, 0.72rem); color: var(--text-muted); margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .release-right { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; flex-shrink: 0; max-width: 110px; }
    .release-date-badge { font-size: 0.63rem; color: var(--text-dim); font-family: 'Space Mono', monospace; white-space: nowrap; text-align: right; }
    .release-countdown { font-size: 0.62rem; color: var(--text-muted); font-family: 'Space Mono', monospace; text-align: right; white-space: nowrap; }
    .release-status { font-size: 0.63rem; font-weight: 700; padding: 2px 8px; border-radius: 20px; letter-spacing: 0.04em; text-transform: uppercase; }
    .release-status.out { background: rgba(59,255,138,0.12); color: var(--success); }
    .release-status.upcoming { background: rgba(255,255,255,0.07); color: var(--text-dim); }
    .btn-delete-release { background: transparent; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; border-radius: 6px; transition: color 0.15s, background 0.15s; flex-shrink: 0; }
    .btn-delete-release:hover { color: var(--danger); background: rgba(255,59,59,0.1); }
    .releases-empty { text-align: center; padding: 60px 20px; color: var(--text-muted); font-size: 0.82rem; line-height: 1.7; }

    /* ‚îÄ‚îÄ ADMIN MSG OVERLAY ‚îÄ‚îÄ */
    .admin-msg-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.97); z-index: 9999; align-items: center; justify-content: center; padding: 24px; }
    .admin-msg-overlay.show { display: flex; }
    .admin-msg-box { max-width: 560px; width: 100%; border: 1.5px solid var(--danger); border-radius: 20px; padding: 40px 32px; text-align: center; background: #0a0a0a; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.96); } to { opacity: 1; transform: scale(1); } }
    .admin-msg-icon { font-size: 2.4rem; margin-bottom: 16px; }
    .admin-msg-title { font-family: 'Syne', sans-serif; font-weight: 800; font-size: clamp(1.3rem, 5vw, 1.8rem); letter-spacing: -0.03em; color: #fff; margin-bottom: 14px; }
    .admin-msg-body { font-size: 0.9rem; color: var(--text-dim); line-height: 1.7; }

    /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
    /* ‚îÄ‚îÄ LINKS ‚îÄ‚îÄ */
    .links-page-inner { width: 100%; max-width: 640px; padding: 20px 20px 60px; }
    .links-page-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .links-page-title { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.3rem; letter-spacing: -0.03em; }
    .link-card { display: flex; align-items: center; gap: 12px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px 14px; margin-bottom: 10px; transition: border-color 0.2s, opacity 0.2s, transform 0.15s; user-select: none; }
    .link-card:hover { border-color: #444; }
    .link-card.dragging { opacity: 0.4; transform: scale(0.98); border-color: var(--border-active); }
    .link-card.drag-over { border-color: var(--border-active); border-style: dashed; }
    .link-card.long-press { transform: scale(1.02); border-color: var(--border-active); box-shadow: 0 4px 20px rgba(255,255,255,0.1); }
    .link-avatar { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; flex-shrink: 0; background: var(--surface2); }
    .link-avatar-placeholder { width: 48px; height: 48px; border-radius: 50%; background: var(--surface2); flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
    .link-info { flex: 1; min-width: 0; }
    .link-name { font-family: 'Syne', sans-serif; font-weight: 800; font-size: clamp(0.68rem, 2.8vw, 0.9rem); letter-spacing: -0.02em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .link-right { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
    .link-icons { display: flex; gap: 8px; }
    .link-icon-btn { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 8px; background: var(--surface2); border: 1px solid var(--border); color: var(--text); text-decoration: none; transition: background 0.15s, border-color 0.15s; flex-shrink: 0; }
    .link-icon-btn:hover { background: var(--border); border-color: var(--text-muted); }
    .link-icon-btn svg { display: block; }
    .link-actions { display: flex; flex-direction: column; gap: 6px; flex-shrink: 0; border-left: 1px solid var(--border); padding-left: 10px; margin-left: 2px; }
    .links-empty { text-align: center; padding: 40px 20px; color: var(--text-muted); font-size: 0.82rem; line-height: 1.8; }

    .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(80px); background: var(--surface); border: 1px solid var(--border); color: var(--text); padding: 10px 18px; border-radius: 100px; font-size: 0.78rem; z-index: 2000; transition: transform 0.25s cubic-bezier(0.34,1.56,0.64,1), opacity 0.2s; opacity: 0; white-space: nowrap; }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    @media (max-width: 480px) {
      .header { padding-top: 20px; }
      .btn-fetch { padding: 14px 16px; font-size: 0.8rem; }
      input[type="text"] { font-size: 0.8rem; }
      .media-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
    }
    @media (max-width: 360px) { .media-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
<div class="admin-msg-overlay" id="adminMsgOverlay">
  <div class="admin-msg-box">
    <div class="admin-msg-icon">üì¢</div>
    <div class="admin-msg-title" id="adminMsgTitle">–í–Ω–∏–º–∞–Ω–∏–µ</div>
    <div class="admin-msg-body" id="adminMsgBody"></div>
  </div>
</div>


</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ª–∏–∑ -->
<div class="modal-overlay" id="releaseModalOverlay">
  <div class="modal">
    <div class="modal-handle"></div>
    <h2 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–ª–∏–∑</h2>
    <input type="hidden" id="editReleaseId"/>

    <div class="release-form-field">
      <label class="release-form-label">–û–±–ª–æ–∂–∫–∞</label>
      <div style="display:flex;gap:6px;margin-bottom:8px;">
        <button type="button" class="cover-tab active" id="coverTabFile" onclick="switchCoverTab('file')">üìÅ –§–∞–π–ª</button>
        <button type="button" class="cover-tab" id="coverTabUrl" onclick="switchCoverTab('url')">üîó –°—Å—ã–ª–∫–∞</button>
      </div>
      <div id="coverFileSection">
        <div class="cover-upload-area" id="coverUploadArea">
          <input type="file" id="coverFileInput" accept="image/*" onchange="handleCoverUpload(event)"/>
          <img class="cover-preview" id="coverPreview" alt="cover"/>
          <div class="upload-text" id="uploadText">–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</div>
        </div>
      </div>
      <div id="coverUrlSection" style="display:none">
        <input type="text" id="coverUrlInput" placeholder="https://..." oninput="handleCoverUrl(this.value)" style="width:100%;padding:12px 14px;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--radius);color:var(--text);font-size:0.85rem;font-family:Space Mono,monospace;outline:none;"/>
        <img class="cover-preview" id="coverUrlPreview" alt="cover" style="margin-top:8px;width:100%;height:140px;object-fit:cover;border-radius:8px;display:none;"/>
      </div>
    </div>

    <div class="release-form-field">
      <label class="release-form-label">–ò–º—è –∞—Ä—Ç–∏—Å—Ç–∞</label>
      <input type="text" id="releaseArtist" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Travis Scott"/>
    </div>

    <div class="release-form-field">
      <label class="release-form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
      <input type="text" id="releaseTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: UTOPIA"/>
    </div>

    <div class="release-form-field">
      <label class="release-form-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –≤—ã—Ö–æ–¥–∞</label>
      <div style="display:flex;gap:8px;margin-bottom:8px;">
        <input type="date" id="releaseDate" style="flex:1"/>
        <input type="time" id="releaseTime" value="00:00" style="width:100px;padding:12px 10px;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--radius);color:var(--text);font-size:0.85rem;font-family:Space Mono,monospace;outline:none;"/>
      </div>
      <div style="display:flex;gap:6px;">
        <button type="button" class="cover-tab" id="tzUTC" onclick="selectTZ('UTC')">UTC</button>
        <button type="button" class="cover-tab active" id="tzKST" onclick="selectTZ('KST')">üá∞üá∑ KST +9</button>
        <button type="button" class="cover-tab" id="tzMSK" onclick="selectTZ('MSK')">üá∑üá∫ MSK +3</button>
        <button type="button" class="cover-tab" id="tzALMT" onclick="selectTZ('ALMT')">üá∞üáø +5</button>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-save" id="modalSaveBtn" onclick="saveRelease()">–î–æ–±–∞–≤–∏—Ç—å</button>
      <button class="btn-cancel" onclick="closeReleaseModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- NAVBAR -->
<nav class="navbar">
  <button class="nav-btn active" id="navInsttik" onclick="switchPage('insttik')">INSTAGRAM</button>
  <button class="nav-btn" id="navRelease" onclick="switchPage('release')">RELEASE</button>
  <button class="nav-btn" id="navLinks" onclick="switchPage('links')">LINKS</button>
</nav>

<!-- PAGE: INSTTIK -->
<div class="page active" id="pageInsttik">
  <div class="header">

    <h1>ZHANSAVER</h1>
    <p class="tagline">Instagram</p>

    <div class="site-disabled-banner" id="siteDisabledBanner">
      üî¥ –°–∞–π—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü—Ä–∏—ë–º —Å—Å—ã–ª–æ–∫ –æ—Ç–∫–ª—é—á—ë–Ω.
    </div>
    <div class="input-row">
      <div class="input-group">
        <input type="text" id="urlInput" placeholder="instagram.com/p/..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
        <button class="btn-paste" onclick="pasteFromClipboard()" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="2" width="10" height="4" rx="1"/>
            <path d="M9 4H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-2"/>
          </svg>
        </button>
      </div>
      <button class="btn-fetch" id="fetchBtn" onclick="fetchMedia()">–ù–∞–π—Ç–∏</button>
    </div>

    <div class="status" id="status">
      <div class="status-inner" id="statusInner"></div>
    </div>
  </div>

  <div class="divider" id="divider"></div>
  <div class="results" id="results"></div>
</div>

<!-- PAGE: RELEASE -->
<div class="page" id="pageRelease">
  <div class="release-page-inner">
    <div class="release-page-header">
      <div class="release-page-title">–†–µ–ª–∏–∑—ã</div>
      <button class="btn-add-release" onclick="openReleaseModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        –î–æ–±–∞–≤–∏—Ç—å
      </button>
    </div>
    <div class="releases-list" id="releasesList">
      <div class="releases-empty">–ù–µ—Ç —Ä–µ–ª–∏–∑–æ–≤.<br>–ù–∞–∂–º–∏ ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π.</div>
    </div>
  </div>
</div>

<!-- PAGE: LINKS -->
<div class="page" id="pageLinks">
  <div class="links-page-inner">
    <div class="links-page-header">
      <div class="links-page-title">Links</div>
      <button class="btn-add-release" onclick="openLinkModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        –î–æ–±–∞–≤–∏—Ç—å
      </button>
    </div>
    <div id="linksList"><div class="links-empty">–ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫.<br>–ù–∞–∂–º–∏ ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é.</div></div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ Links -->
<div class="modal-overlay" id="linkModalOverlay">
  <div class="modal">
    <div class="modal-handle"></div>
    <h2 id="linkModalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</h2>
    <input type="hidden" id="editLinkId"/>
    <div class="release-form-field">
      <label class="release-form-label">–ê–≤–∞—Ç–∞—Ä–∫–∞</label>
      <div style="display:flex;gap:6px;margin-bottom:8px;">
        <button type="button" class="cover-tab active" id="avatarTabFile" onclick="switchAvatarTab('file')">üìÅ –§–∞–π–ª</button>
        <button type="button" class="cover-tab" id="avatarTabUrl" onclick="switchAvatarTab('url')">üîó –°—Å—ã–ª–∫–∞</button>
      </div>
      <div id="avatarFileSection">
        <div class="cover-upload-area" id="linkAvatarArea">
          <input type="file" id="linkAvatarInput" accept="image/*" onchange="handleLinkAvatar(event)"/>
          <img class="cover-preview" id="linkAvatarPreview" alt="avatar"/>
          <div class="upload-text" id="linkAvatarText">–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ</div>
        </div>
      </div>
      <div id="avatarUrlSection" style="display:none">
        <input type="text" id="linkAvatarUrl" placeholder="https://..." oninput="handleLinkAvatarUrl(this.value)" style="width:100%;padding:12px 14px;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--radius);color:var(--text);font-size:0.85rem;font-family:Space Mono,monospace;outline:none;"/>
        <img id="linkAvatarUrlPreview" alt="preview" style="margin-top:8px;width:64px;height:64px;object-fit:cover;border-radius:50%;display:none;"/>
      </div>
    </div>
    <div class="release-form-field">
      <label class="release-form-label">–ò–º—è –∞—Ä—Ç–∏—Å—Ç–∞</label>
      <input type="text" id="linkArtist" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: IVE"/>
    </div>
    <div class="release-form-field">
      <label class="release-form-label">Instagram</label>
      <input type="text" id="linkInstagram" placeholder="https://instagram.com/@..."/>
    </div>
    <div class="release-form-field">
      <label class="release-form-label">TikTok</label>
      <input type="text" id="linkTiktok" placeholder="https://tiktok.com/@..."/>
    </div>
    <div class="release-form-field">
      <label class="release-form-label">YouTube</label>
      <input type="text" id="linkYoutube" placeholder="https://youtube.com/@..."/>
    </div>
    <div class="release-form-field">
      <label class="release-form-label">Spotify</label>
      <input type="text" id="linkSpotify" placeholder="https://open.spotify.com/artist/..."/>
    </div>
    <div class="modal-actions">
      <button class="btn-save" id="linkSaveBtn" onclick="saveLink()">–î–æ–±–∞–≤–∏—Ç—å</button>
      <button class="btn-cancel" onclick="closeLinkModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<script>
  const DL_ICON = `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v10M7 15l5 5 5-5"/><path d="M5 20h14"/></svg>`;
  let siteEnabled = true;
  let coverBase64 = null;
  let coverChanged = false;

  // ‚îÄ‚îÄ –ù–∞–≤–∏–≥–∞—Ü–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function switchPage(page) {
    document.querySelectorAll('.page').forEach(p => { p.classList.remove('active'); p.style.display = 'none'; });
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    const pageEl = document.getElementById('page' + page.charAt(0).toUpperCase() + page.slice(1));
    if (pageEl) { pageEl.classList.add('active'); pageEl.style.display = 'flex'; }
    const navEl = document.getElementById('nav' + page.charAt(0).toUpperCase() + page.slice(1));
    if (navEl) navEl.classList.add('active');
    if (page === 'release') loadReleases();
    if (page === 'links') loadLinks();
  }

  // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showToast(msg, duration = 2000) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), duration);
  }

  // ‚îÄ‚îÄ Clipboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function pasteFromClipboard() {
    try {
      const text = await navigator.clipboard.readText();
      if (text) { document.getElementById('urlInput').value = text.trim(); showToast('–°—Å—ã–ª–∫–∞ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞'); }
      else showToast('–ë—É—Ñ–µ—Ä –ø—É—Å—Ç');
    } catch { showToast('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±—É—Ñ–µ—Ä—É ‚Äî –≤—Å—Ç–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é'); }
  }

  // ‚îÄ‚îÄ –°—Ç–∞—Ç—É—Å —Å–∞–π—Ç–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function checkSiteStatus() {
    try {
      const res = await fetch('/api/status');
      const data = await res.json();
      siteEnabled = data.siteEnabled !== false;
      if (!siteEnabled) {
        document.getElementById('siteDisabledBanner').classList.add('show');
        document.getElementById('fetchBtn').disabled = true;
        document.getElementById('urlInput').disabled = true;
      } else {
        document.getElementById('siteDisabledBanner').classList.remove('show');
        document.getElementById('fetchBtn').disabled = false;
        document.getElementById('urlInput').disabled = false;
      }
      if (data.siteMessage?.active && data.siteMessage.title) {
        document.getElementById('adminMsgTitle').textContent = data.siteMessage.title;
        document.getElementById('adminMsgBody').textContent = data.siteMessage.body || '';
        document.getElementById('adminMsgOverlay').classList.add('show');
      } else {
        document.getElementById('adminMsgOverlay').classList.remove('show');
      }
    } catch {}
  }
  // ‚îÄ‚îÄ –°—Ç–∞—Ç—É—Å –ø–æ–∏—Å–∫–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showStatus(msg, type) {
    document.getElementById('statusInner').textContent = msg;
    document.getElementById('status').className = 'status ' + type;
  }
  function hideStatus() { document.getElementById('status').className = 'status'; }

  // ‚îÄ‚îÄ Fetch –º–µ–¥–∏–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function fetchMedia() {
    if (!siteEnabled) { showStatus('‚ùå –°–∞–π—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.', 'error'); return; }
    const url = document.getElementById('urlInput').value.trim();
    const btn = document.getElementById('fetchBtn');
    const results = document.getElementById('results');
    const divider = document.getElementById('divider');
    results.className = 'results'; results.innerHTML = '';
    divider.className = 'divider';
    if (!url) { showStatus('–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç', 'error'); return; }
    btn.disabled = true; btn.textContent = '...';
    showStatus('–ü–æ–ª—É—á–∞–µ–º –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã...', 'loading');
    try {
      const res = await fetch('/api/fetch', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ url }) });
      const data = await res.json();
      if (!data.success) {
        showStatus('‚ùå ' + (data.siteDisabled ? '–°–∞–π—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.' : data.error), 'error');
        return;
      }
      hideStatus();
      renderResults(data.media, data.shortcode);
    } catch { showStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error'); }
    finally { btn.disabled = !siteEnabled; btn.textContent = '–ù–∞–π—Ç–∏'; }
  }
  function download(mediaUrl, filename) {
    const a = document.createElement('a');
    a.href = `/proxy?url=${encodeURIComponent(mediaUrl)}&dl=1`;
    a.download = filename;
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
  }

  function renderResults(media, shortcode) {
    const results = document.getElementById('results');
    const divider = document.getElementById('divider');
    results.innerHTML = '';

    if (media.length === 1) {
      const item = media[0];
      const ext = item.type === 'video' ? 'mp4' : 'jpg';
      const wrap = document.createElement('div');
      wrap.className = 'single-media';

      if (item.type === 'video') {
        const v = document.createElement('video');
        v.className = 'single-video';
        v.src = `/proxy?url=${encodeURIComponent(item.url)}`;
        v.playsinline = true;
        v.preload = 'auto';
        v.setAttribute('webkit-playsinline', '');
        v.style.maxHeight = '70vh';
        v.onclick = () => v.paused ? v.play() : v.pause();
        wrap.appendChild(v);
      } else {
        const img = document.createElement('img');
        img.src = `/proxy?url=${encodeURIComponent(item.url)}`; img.alt = 'photo';
        wrap.appendChild(img);
      }

      const dlBtn = document.createElement('button');
      dlBtn.className = 'btn-dl';
      dlBtn.innerHTML = `${DL_ICON} –°–∫–∞—á–∞—Ç—å ${item.type === 'video' ? '–≤–∏–¥–µ–æ' : '—Ñ–æ—Ç–æ'}`;
      dlBtn.onclick = () => {
        download(item.url, `media_${shortcode}.${ext}`);
        dlBtn.className = 'btn-dl done'; dlBtn.textContent = '‚úì –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è';
        setTimeout(() => { dlBtn.className = 'btn-dl'; dlBtn.innerHTML = `${DL_ICON} –°–∫–∞—á–∞—Ç—å`; }, 3000);
      };
      wrap.appendChild(dlBtn);
      results.appendChild(wrap);
    } else {
      const header = document.createElement('div'); header.className = 'results-header';
      const title = document.createElement('span'); title.className = 'results-title'; title.textContent = `${media.length} —Ñ–∞–π–ª–æ–≤`;
      const dlAll = document.createElement('button'); dlAll.className = 'btn-dl-all';
      dlAll.innerHTML = `${DL_ICON} –°–∫–∞—á–∞—Ç—å –≤—Å–µ`;
      dlAll.onclick = () => media.forEach((item, i) =>
        setTimeout(() => download(item.url, `media_${shortcode}_${i+1}.${item.type==='video'?'mp4':'jpg'}`), i * 700)
      );
      header.appendChild(title); header.appendChild(dlAll); results.appendChild(header);

      const grid = document.createElement('div'); grid.className = 'media-grid';
      media.forEach((item, i) => {
        const ext = item.type === 'video' ? 'mp4' : 'jpg';
        const card = document.createElement('div'); card.className = 'media-card';
        const thumbWrap = document.createElement('div'); thumbWrap.className = 'media-thumb';

        // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É (thumb –∏–ª–∏ post–µ—Ä), –±–µ–∑ –≤–∏–¥–µ–æ-—ç–ª–µ–º–µ–Ω—Ç–∞
        const img = document.createElement('img');
        if (item.type === 'video') {
          img.src = item.thumb ? `/proxy?url=${encodeURIComponent(item.thumb)}` : '';
        } else {
          img.src = `/proxy?url=${encodeURIComponent(item.url)}`;
        }
        img.loading = 'lazy'; img.alt = `${item.type === 'video' ? '–í–∏–¥–µ–æ' : '–§–æ—Ç–æ'} ${i+1}`;
        thumbWrap.appendChild(img);

        const badge = document.createElement('span'); badge.className = 'media-badge';
        badge.textContent = item.type === 'video' ? '‚ñ∂ –í–ò–î–ï–û' : '–§–û–¢–û';
        thumbWrap.appendChild(badge);

        const footer = document.createElement('div'); footer.className = 'media-footer';
        const idx = document.createElement('span'); idx.className = 'media-index'; idx.textContent = `${i+1} / ${media.length}`;
        const dlBtn = document.createElement('button'); dlBtn.className = 'btn-dl';
        dlBtn.innerHTML = `${DL_ICON} –°–∫–∞—á–∞—Ç—å`;
        dlBtn.onclick = () => {
          download(item.url, `media_${shortcode}_${i+1}.${ext}`);
          dlBtn.className = 'btn-dl done'; dlBtn.textContent = '‚úì';
          setTimeout(() => { dlBtn.className = 'btn-dl'; dlBtn.innerHTML = `${DL_ICON} –°–∫–∞—á–∞—Ç—å`; }, 3000);
        };
        footer.appendChild(idx); footer.appendChild(dlBtn);
        card.appendChild(thumbWrap); card.appendChild(footer);
        grid.appendChild(card);
      });
      results.appendChild(grid);
    }

    divider.className = 'divider show';
    results.className = 'results show';
    results.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  document.getElementById('urlInput').addEventListener('keydown', e => { if (e.key === 'Enter') fetchMedia(); });

  // ‚îÄ‚îÄ RELEASE PAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let selectedTZ = 'KST';

  function selectTZ(tz) {
    selectedTZ = tz;
    ['UTC','KST','MSK','ALMT'].forEach(t => {
      document.getElementById('tz' + t).classList.toggle('active', t === tz);
    });
  }

  function openReleaseModal() {
    coverBase64 = null;
    coverChanged = false;
    document.getElementById('editReleaseId').value = '';
    document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–ª–∏–∑';
    document.getElementById('modalSaveBtn').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
    document.getElementById('coverPreview').style.display = 'none';
    document.getElementById('uploadText').style.display = 'block';
    document.getElementById('coverFileInput').value = '';
    document.getElementById('coverUrlInput').value = '';
    document.getElementById('coverUrlPreview').style.display = 'none';
    document.getElementById('releaseArtist').value = '';
    document.getElementById('releaseTitle').value = '';
    document.getElementById('releaseDate').value = '';
    document.getElementById('releaseTime').value = '00:00';
    selectTZ('KST');
    switchCoverTab('file');
    document.getElementById('releaseModalOverlay').classList.add('show');
  }

  function openEditModal(r) {
    coverBase64 = r.cover || null;
    coverChanged = false;
    document.getElementById('editReleaseId').value = r.id;
    document.getElementById('modalTitle').textContent = '–ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–ª–∏–∑';
    document.getElementById('modalSaveBtn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
    document.getElementById('releaseArtist').value = r.artist || '';
    document.getElementById('releaseTitle').value = r.title || '';
    document.getElementById('releaseDate').value = r.releaseDate || '';
    document.getElementById('releaseTime').value = r.releaseTime || '00:00';
    selectTZ(r.timezone || 'KST');
    // –û–±–ª–æ–∂–∫–∞
    if (r.cover && r.cover.startsWith('http')) {
      switchCoverTab('url');
      document.getElementById('coverUrlInput').value = r.cover;
      const prev = document.getElementById('coverUrlPreview');
      prev.src = r.cover; prev.style.display = 'block';
    } else if (r.cover) {
      switchCoverTab('file');
      const prev = document.getElementById('coverPreview');
      prev.src = r.cover; prev.style.display = 'block';
      document.getElementById('uploadText').style.display = 'none';
    } else {
      switchCoverTab('file');
    }
    document.getElementById('releaseModalOverlay').classList.add('show');
  }

  function switchCoverTab(tab) {
    document.getElementById('coverFileSection').style.display = tab === 'file' ? 'block' : 'none';
    document.getElementById('coverUrlSection').style.display = tab === 'url' ? 'block' : 'none';
    document.getElementById('coverTabFile').className = 'cover-tab' + (tab === 'file' ? ' active' : '');
    document.getElementById('coverTabUrl').className = 'cover-tab' + (tab === 'url' ? ' active' : '');
    if (tab === 'file') { coverBase64 = null; document.getElementById('coverUrlInput').value = ''; }
    else { coverBase64 = null; document.getElementById('coverFileInput').value = ''; document.getElementById('coverPreview').style.display = 'none'; document.getElementById('uploadText').style.display = 'block'; }
  }

  function handleCoverUrl(val) {
    const preview = document.getElementById('coverUrlPreview');
    if (val.startsWith('http')) {
      preview.src = val;
      preview.style.display = 'block';
      preview.onerror = () => { preview.style.display = 'none'; };
      coverBase64 = val;
      coverChanged = true;
    } else {
      preview.style.display = 'none';
      coverBase64 = null;
    }
  }
  function closeReleaseModal() { document.getElementById('releaseModalOverlay').classList.remove('show'); }
  document.getElementById('releaseModalOverlay').addEventListener('click', e => { if (e.target.id === 'releaseModalOverlay') closeReleaseModal(); });

  function handleCoverUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      coverBase64 = e.target.result;
      coverChanged = true;
      const preview = document.getElementById('coverPreview');
      preview.src = coverBase64;
      preview.style.display = 'block';
      document.getElementById('uploadText').style.display = 'none';
    };
    reader.readAsDataURL(file);
  }

  async function saveRelease() {
    const artist = document.getElementById('releaseArtist').value.trim();
    const title = document.getElementById('releaseTitle').value.trim();
    const releaseDate = document.getElementById('releaseDate').value;
    const releaseTime = document.getElementById('releaseTime').value || '00:00';
    const timezone = selectedTZ;
    const editId = document.getElementById('editReleaseId').value;
    if (!artist || !title || !releaseDate) { showToast('–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!'); return; }

    const isEdit = !!editId;
    // –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: –µ—Å–ª–∏ coverBase64 –Ω–µ –º–µ–Ω—è–ª—Å—è (–æ—Å—Ç–∞–ª—Å—è –∫–∞–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏) ‚Äî –ø–µ—Ä–µ–¥–∞—ë–º null —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–≤–∏–ª —Å—Ç–∞—Ä—É—é –æ–±–ª–æ–∂–∫—É
    // coverChanged –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –±—ã–ª –ª–∏ —Ñ–∞–π–ª/url –≤—ã–±—Ä–∞–Ω –∑–∞–Ω–æ–≤–æ
    const body = { artist, title, releaseDate, releaseTime, timezone, cover: coverChanged ? coverBase64 : null };
    const res = await fetch(isEdit ? `/api/releases/${editId}` : '/api/releases', {
      method: isEdit ? 'PUT' : 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (data.success) {
      closeReleaseModal();
      loadReleases();
      showToast(isEdit ? '‚úì –†–µ–ª–∏–∑ –æ–±–Ω–æ–≤–ª—ë–Ω!' : '‚úì –†–µ–ª–∏–∑ –¥–æ–±–∞–≤–ª–µ–Ω!');
    } else {
      showToast('–û—à–∏–±–∫–∞: ' + data.error);
    }
  }

  async function loadReleases() {
    try {
      const res = await fetch('/api/releases');
      const releases = await res.json();
      renderReleases(releases);
    } catch { showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–ª–∏–∑–æ–≤'); }
  }

  function renderReleases(releases) {
    const list = document.getElementById('releasesList');
    if (!releases.length) {
      list.innerHTML = '<div class="releases-empty">–ù–µ—Ç —Ä–µ–ª–∏–∑–æ–≤.<br>–ù–∞–∂–º–∏ ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π.</div>';
      return;
    }
    list.innerHTML = '';
    releases.forEach(r => {
      const TZOFF = { KST: 9, MSK: 3, ALMT: 5, UTC: 0 };
      const offset = TZOFF[r.timezone] !== undefined ? TZOFF[r.timezone] : 0;
      const dt = new Date(`${r.releaseDate}T${r.releaseTime || '00:00'}:00Z`);
      dt.setHours(dt.getHours() - offset);
      const isReleased = dt <= new Date();
      const card = document.createElement('div');
      card.className = 'release-card' + (isReleased ? ' released' : '');

      // –û–±–ª–æ–∂–∫–∞
      if (r.cover) {
        const img = document.createElement('img');
        img.className = 'release-cover'; img.src = r.cover; img.alt = r.title;
        card.appendChild(img);
      } else {
        const ph = document.createElement('div');
        ph.className = 'release-cover-placeholder'; ph.textContent = 'üéµ';
        card.appendChild(ph);
      }

      // –ò–Ω—Ñ–æ
      const info = document.createElement('div'); info.className = 'release-info';
      const titleEl = document.createElement('div'); titleEl.className = 'release-title-text'; titleEl.textContent = r.title;
      const artistEl = document.createElement('div'); artistEl.className = 'release-artist-text'; artistEl.textContent = r.artist;
      info.appendChild(titleEl); info.appendChild(artistEl);
      card.appendChild(info);

      // –ü—Ä–∞–≤—ã–π –±–ª–æ–∫
      const right = document.createElement('div'); right.className = 'release-right';
      const dateBadge = document.createElement('div'); dateBadge.className = 'release-date-badge';
      dateBadge.textContent = formatDate(r.releaseDate, r.releaseTime, r.timezone);
      right.appendChild(dateBadge);
      if (!isReleased) {
        const countdown = document.createElement('div');
        countdown.className = 'release-countdown';
        countdown.dataset.releaseTs = dt.getTime();
        updateCountdown(countdown, dt);
        right.appendChild(countdown);
      }
      const statusBadge = document.createElement('div');
      statusBadge.className = 'release-status ' + (isReleased ? 'out' : 'upcoming');
      statusBadge.textContent = isReleased ? '‚úì –í—ã—à–µ–ª' : '–°–∫–æ—Ä–æ';
      right.appendChild(statusBadge);
      card.appendChild(right);

      // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–∏—Ç—å
      // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
      const actions = document.createElement('div'); actions.style.cssText = 'display:flex;flex-direction:column;gap:6px;margin-left:4px;';
      const editBtn = document.createElement('button'); editBtn.className = 'btn-delete-release';
      editBtn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`;
      editBtn.title = '–ò–∑–º–µ–Ω–∏—Ç—å'; editBtn.style.opacity = '0.6';
      editBtn.onclick = () => openEditModal(r);
      const delBtn = document.createElement('button'); delBtn.className = 'btn-delete-release';
      delBtn.innerHTML = `<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="3,6 5,6 21,6"/><path d="M19,6l-1,14a2,2,0,0,1-2,2H8a2,2,0,0,1-2-2L5,6"/><path d="M10,11v6"/><path d="M14,11v6"/></svg>`;
      delBtn.title = '–£–¥–∞–ª–∏—Ç—å'; delBtn.onclick = () => deleteRelease(r.id);
      actions.appendChild(editBtn); actions.appendChild(delBtn);
      card.appendChild(actions);

      list.appendChild(card);
    });
  }

  async function deleteRelease(id) {
    await fetch(`/api/releases/${id}`, { method: 'DELETE' });
    loadReleases();
    showToast('–£–¥–∞–ª–µ–Ω–æ');
  }

  function updateCountdown(el, targetDate) {
    const diff = targetDate - new Date();
    if (diff <= 0) { el.textContent = ''; return; }
    const d = Math.floor(diff / 86400000);
    const h = Math.floor((diff % 86400000) / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    if (d > 0) el.textContent = d + '–¥ ' + String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
    else el.textContent = String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
  }

  // –¢–∏–∫–∞–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
  setInterval(() => {
    document.querySelectorAll('.release-countdown[data-release-ts]').forEach(el => {
      const ts = Number(el.dataset.releaseTs);
      updateCountdown(el, new Date(ts));
    });
  }, 1000);

  function formatDate(dateStr, timeStr, tz) {
    if (!dateStr) return '';
    const [y, m, d] = dateStr.split('-');
    const months = ['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];
    let base = `${parseInt(d)} ${months[parseInt(m)-1]} ${y}`;
    if (timeStr && timeStr !== '00:00') base += ` ¬∑ ${timeStr}`;
    if (tz && tz !== 'UTC') base += ` ${tz}`;
    return base;
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  checkSiteStatus();
  setInterval(checkSiteStatus, 30000);

  // ‚îÄ‚îÄ LINKS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let linkAvatarBase64 = null;
  let linkAvatarChanged = false;

  function openLinkModal() {
    linkAvatarBase64 = null; linkAvatarChanged = false;
    document.getElementById('editLinkId').value = '';
    document.getElementById('linkModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É';
    document.getElementById('linkSaveBtn').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
    document.getElementById('linkArtist').value = '';
    document.getElementById('linkInstagram').value = '';
    document.getElementById('linkTiktok').value = '';
    document.getElementById('linkYoutube').value = '';
    document.getElementById('linkSpotify').value = '';
    document.getElementById('linkAvatarInput').value = '';
    document.getElementById('linkAvatarPreview').style.display = 'none';
    document.getElementById('linkAvatarText').style.display = 'block';
    document.getElementById('linkAvatarUrl').value = '';
    document.getElementById('linkAvatarUrlPreview').style.display = 'none';
    switchAvatarTab('file');
    document.getElementById('linkModalOverlay').classList.add('show');
  }

  function closeLinkModal() { document.getElementById('linkModalOverlay').classList.remove('show'); }
  document.getElementById('linkModalOverlay').addEventListener('click', e => { if (e.target.id === 'linkModalOverlay') closeLinkModal(); });

  function switchAvatarTab(tab) {
    document.getElementById('avatarFileSection').style.display = tab === 'file' ? '' : 'none';
    document.getElementById('avatarUrlSection').style.display = tab === 'url' ? '' : 'none';
    document.getElementById('avatarTabFile').classList.toggle('active', tab === 'file');
    document.getElementById('avatarTabUrl').classList.toggle('active', tab === 'url');
  }

  function handleLinkAvatar(event) {
    const file = event.target.files[0]; if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      linkAvatarBase64 = e.target.result; linkAvatarChanged = true;
      const prev = document.getElementById('linkAvatarPreview');
      prev.src = linkAvatarBase64; prev.style.display = 'block';
      document.getElementById('linkAvatarText').style.display = 'none';
    };
    reader.readAsDataURL(file);
  }

  function handleLinkAvatarUrl(val) {
    const prev = document.getElementById('linkAvatarUrlPreview');
    if (val.startsWith('http')) {
      prev.src = '/api/proxy-image?url=' + encodeURIComponent(val);
      prev.style.display = 'block';
      prev.onerror = () => prev.style.display = 'none';
      linkAvatarBase64 = val; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL
      linkAvatarChanged = true;
    } else {
      prev.style.display = 'none';
    }
  }

  function openEditLinkModal(card) {
    linkAvatarBase64 = card.avatar || null; linkAvatarChanged = false;
    document.getElementById('editLinkId').value = card.id;
    document.getElementById('linkModalTitle').textContent = '–ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É';
    document.getElementById('linkSaveBtn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
    document.getElementById('linkArtist').value = card.artist || '';
    document.getElementById('linkInstagram').value = card.instagram || '';
    document.getElementById('linkTiktok').value = card.tiktok || '';
    document.getElementById('linkYoutube').value = card.youtube || '';
    document.getElementById('linkSpotify').value = card.spotify || '';
    if (card.avatar && card.avatar.startsWith('http')) {
      switchAvatarTab('url');
      document.getElementById('linkAvatarUrl').value = card.avatar;
      const urlPrev = document.getElementById('linkAvatarUrlPreview');
      urlPrev.src = '/api/proxy-image?url=' + encodeURIComponent(card.avatar); urlPrev.style.display = 'block';
    } else if (card.avatar) {
      switchAvatarTab('file');
      const prev = document.getElementById('linkAvatarPreview');
      prev.src = card.avatar; prev.style.display = 'block';
      document.getElementById('linkAvatarText').style.display = 'none';
    } else {
      switchAvatarTab('file');
      document.getElementById('linkAvatarPreview').style.display = 'none';
      document.getElementById('linkAvatarText').style.display = 'block';
    }
    document.getElementById('linkModalOverlay').classList.add('show');
  }

  async function saveLink() {
    const artist = document.getElementById('linkArtist').value.trim();
    const instagram = document.getElementById('linkInstagram').value.trim();
    const tiktok = document.getElementById('linkTiktok').value.trim();
    const youtube = document.getElementById('linkYoutube').value.trim();
    const spotify = document.getElementById('linkSpotify').value.trim();
    if (!artist) { showToast('–£–∫–∞–∂–∏ –∏–º—è –∞—Ä—Ç–∏—Å—Ç–∞!'); return; }
    const editId = document.getElementById('editLinkId').value;
    const avatar = linkAvatarChanged ? linkAvatarBase64 : null;
    const res = await fetch(editId ? `/api/links/${editId}` : '/api/links', {
      method: editId ? 'PUT' : 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ artist, instagram, tiktok, youtube, spotify, avatar })
    });
    const data = await res.json();
    if (data.success) { closeLinkModal(); loadLinks(); showToast(editId ? '‚úì –û–±–Ω–æ–≤–ª–µ–Ω–æ!' : '‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ!'); }
    else showToast('–û—à–∏–±–∫–∞: ' + data.error);
  }

  async function deleteLink(id) {
    await fetch(`/api/links/${id}`, { method: 'DELETE' });
    loadLinks(); showToast('–£–¥–∞–ª–µ–Ω–æ');
  }

  async function loadLinks() {
    try {
      const res = await fetch('/api/links');
      const links = await res.json();
      renderLinks(links);
    } catch { showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫'); }
  }

  const SOCIAL_ICONS = {
    instagram: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="4"/><circle cx="17.5" cy="6.5" r="1" fill="currentColor" stroke="none"/></svg>`,
    tiktok:    `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1V9.01a6.32 6.32 0 00-.79-.05 6.34 6.34 0 00-6.34 6.34 6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.33-6.34V8.69a8.18 8.18 0 004.78 1.52V6.75a4.85 4.85 0 01-1.01-.06z"/></svg>`,
    youtube:   `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23 7s-.3-2-1.2-2.8c-1.1-1.2-2.4-1.2-3-1.3C16.6 2.8 12 2.8 12 2.8s-4.6 0-6.8.1c-.6.1-1.9.1-3 1.3C1.3 5 1 7 1 7S.7 9.2.7 11.4v2.1c0 2.2.3 4.4.3 4.4s.3 2 1.2 2.8c1.1 1.2 2.6 1.1 3.3 1.2C7.5 22 12 22 12 22s4.6 0 6.8-.2c.6-.1 1.9-.1 3-1.2.9-.8 1.2-2.8 1.2-2.8s.3-2.2.3-4.4v-2.1C23.3 9.2 23 7 23 7zM9.7 15.5V8.4l8.1 3.6-8.1 3.5z"/></svg>`,
    spotify:   `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.586 14.424a.622.622 0 01-.857.207c-2.348-1.435-5.304-1.76-8.785-.964a.622.622 0 11-.277-1.215c3.809-.87 7.076-.496 9.712 1.115.294.181.387.564.207.857zm1.224-2.722a.78.78 0 01-1.072.257c-2.687-1.652-6.785-2.131-9.965-1.166a.78.78 0 01-.973-.519.781.781 0 01.52-.973c3.632-1.102 8.147-.568 11.233 1.329a.78.78 0 01.257 1.072zm.105-2.835c-3.223-1.914-8.54-2.09-11.618-1.156a.935.935 0 11-.542-1.79c3.532-1.072 9.404-.865 13.115 1.338a.935.935 0 01-.955 1.608z"/></svg>`
  };

  let linksData = [];
  let dragSrcId = null;
  let longPressTimer = null;
  let isDragMode = false;
  let dragGhost = null;
  let dragCardEl = null;
  let dragCardId = null;

  function renderLinks(links) {
    linksData = links || [];
    const list = document.getElementById('linksList');
    if (!linksData.length) {
      list.innerHTML = '<div class="links-empty">–ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫.<br>–ù–∞–∂–º–∏ ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é.</div>';
      return;
    }
    list.innerHTML = '';
    linksData.forEach(card => {
      const el = document.createElement('div');
      el.className = 'link-card';
      el.dataset.id = card.id;

      // –ê–≤–∞—Ç–∞—Ä–∫–∞
      if (card.avatar) {
        const img = document.createElement('img');
        img.className = 'link-avatar';
        img.src = card.avatar.startsWith('http') ? '/api/proxy-image?url=' + encodeURIComponent(card.avatar) : card.avatar;
        img.onerror = () => img.replaceWith(makePlaceholder());
        el.appendChild(img);
      } else { el.appendChild(makePlaceholder()); }

      // –ò–º—è
      const info = document.createElement('div'); info.className = 'link-info';
      const name = document.createElement('div'); name.className = 'link-name'; name.textContent = card.artist;
      info.appendChild(name); el.appendChild(info);

      // –ò–∫–æ–Ω–∫–∏ —Å–ø—Ä–∞–≤–∞
      const right = document.createElement('div'); right.className = 'link-right';
      const icons = document.createElement('div'); icons.className = 'link-icons';
      if (card.instagram) icons.appendChild(makeLinkIcon('instagram', card.instagram.startsWith('http') ? card.instagram : 'https://instagram.com/' + card.instagram));
      if (card.tiktok) icons.appendChild(makeLinkIcon('tiktok', card.tiktok));
      if (card.youtube) icons.appendChild(makeLinkIcon('youtube', card.youtube));
      if (card.spotify) icons.appendChild(makeLinkIcon('spotify', card.spotify));
      right.appendChild(icons); el.appendChild(right);

      // –ö–Ω–æ–ø–∫–∏
      const actions = document.createElement('div'); actions.className = 'link-actions';
      const editBtn = document.createElement('button'); editBtn.className = 'btn-delete-release';
      editBtn.style.opacity = '0.6';
      editBtn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`;
      editBtn.onclick = (e) => { e.stopPropagation(); openEditLinkModal(card); };
      const delBtn = document.createElement('button'); delBtn.className = 'btn-delete-release';
      delBtn.innerHTML = `<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="3,6 5,6 21,6"/><path d="M19,6l-1,14a2,2,0,0,1-2,2H8a2,2,0,0,1-2-2L5,6"/><path d="M10,11v6"/><path d="M14,11v6"/></svg>`;
      delBtn.onclick = (e) => { e.stopPropagation(); deleteLink(card.id); };
      actions.appendChild(editBtn); actions.appendChild(delBtn);
      el.appendChild(actions);

      // ‚îÄ‚îÄ Drag & Drop (desktop) ‚îÄ‚îÄ
      el.draggable = false; // –≤–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ long press
      el.addEventListener('dragstart', e => {
        if (!isDragMode) { e.preventDefault(); return; }
        dragSrcId = card.id;
        el.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      });
      el.addEventListener('dragend', () => { el.classList.remove('dragging'); isDragMode = false; el.draggable = false; });
      el.addEventListener('dragover', e => { e.preventDefault(); el.classList.add('drag-over'); });
      el.addEventListener('dragleave', () => el.classList.remove('drag-over'));
      el.addEventListener('drop', e => {
        e.preventDefault(); el.classList.remove('drag-over');
        if (dragSrcId == null || dragSrcId === card.id) return;
        const srcIdx = linksData.findIndex(l => l.id == dragSrcId);
        const dstIdx = linksData.findIndex(l => l.id === card.id);
        if (srcIdx === -1 || dstIdx === -1) return;
        const [moved] = linksData.splice(srcIdx, 1);
        linksData.splice(dstIdx, 0, moved);
        saveLinkOrder();
        renderLinks(linksData);
      });

      // ‚îÄ‚îÄ Long press ‚Üí drag ‚îÄ‚îÄ
      el.addEventListener('touchstart', e => {
        clearTimeout(longPressTimer);
        const touch = e.touches[0];
        longPressTimer = setTimeout(() => {
          isDragMode = true;
          dragCardEl = el;
          dragCardId = card.id;
          if (navigator.vibrate) navigator.vibrate(50);
          el.classList.add('long-press');
          setTimeout(() => el.classList.remove('long-press'), 300);
          // –°–æ–∑–¥–∞—ë–º ghost
          dragGhost = el.cloneNode(true);
          dragGhost.style.cssText = `position:fixed;z-index:9999;pointer-events:none;opacity:0.85;width:${el.offsetWidth}px;transform:scale(1.03);box-shadow:0 8px 30px rgba(0,0,0,0.5);left:${el.getBoundingClientRect().left}px;top:${el.getBoundingClientRect().top}px;transition:none;`;
          document.body.appendChild(dragGhost);
          el.style.opacity = '0.3';
        }, 500);
      }, { passive: true });

      el.addEventListener('touchmove', e => { clearTimeout(longPressTimer); }, { passive: true });
      el.addEventListener('touchend', () => { clearTimeout(longPressTimer); });

      list.appendChild(el);
    });
  }

  // ‚îÄ‚îÄ Global touch move/end for drag ‚îÄ‚îÄ
  document.addEventListener('touchmove', e => {
    if (!isDragMode || !dragGhost) return;
    e.preventDefault();
    const touch = e.touches[0];
    const x = touch.clientX, y = touch.clientY;
    dragGhost.style.left = (x - dragGhost.offsetWidth / 2) + 'px';
    dragGhost.style.top = (y - dragGhost.offsetHeight / 2) + 'px';
    // Highlight target
    const listEl = document.getElementById('linksList');
    const cards = [...listEl.querySelectorAll('.link-card')];
    cards.forEach(c => c.classList.remove('drag-over'));
    const target = cards.find(c => {
      const r = c.getBoundingClientRect();
      return y >= r.top && y <= r.bottom && c !== dragCardEl;
    });
    if (target) target.classList.add('drag-over');
  }, { passive: false });

  document.addEventListener('touchend', e => {
    if (!isDragMode) return;
    isDragMode = false;
    if (dragGhost) { dragGhost.remove(); dragGhost = null; }
    if (dragCardEl) { dragCardEl.style.opacity = ''; }
    const listEl = document.getElementById('linksList');
    const cards = [...listEl.querySelectorAll('.link-card')];
    cards.forEach(c => c.classList.remove('drag-over'));
    const touch = e.changedTouches[0];
    const y = touch.clientY;
    const target = cards.find(c => {
      const r = c.getBoundingClientRect();
      return y >= r.top && y <= r.bottom && c !== dragCardEl;
    });
    if (target && dragCardId != null) {
      const srcIdx = linksData.findIndex(l => l.id == dragCardId);
      const dstIdx = linksData.findIndex(l => l.id == Number(target.dataset.id));
      if (srcIdx !== -1 && dstIdx !== -1) {
        const [moved] = linksData.splice(srcIdx, 1);
        linksData.splice(dstIdx, 0, moved);
        saveLinkOrder();
        renderLinks(linksData);
      }
    }
    dragCardEl = null; dragCardId = null;
  });

  async function saveLinkOrder() {
    await fetch('/api/links/reorder', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ ids: linksData.map(l => l.id) })
    });
  }

  function makePlaceholder() {
    const ph = document.createElement('div'); ph.className = 'link-avatar-placeholder'; ph.textContent = 'üé§'; return ph;
  }
  function makeLinkIcon(type, url) {
    const a = document.createElement('a'); a.className = 'link-icon-btn';
    a.href = url; a.target = '_blank'; a.rel = 'noopener';
    a.innerHTML = SOCIAL_ICONS[type]; return a;
  }

  // ‚îÄ‚îÄ THEME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function applyTheme(theme) {
    document.body.classList.toggle('light', theme === 'light');
    document.getElementById('themeBtn').textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
  }
  function toggleTheme() {
    const next = document.body.classList.contains('light') ? 'dark' : 'light';
    localStorage.setItem('theme', next);
    applyTheme(next);
  }
  applyTheme(localStorage.getItem('theme') || 'dark');

</script>
<button class="theme-btn" id="themeBtn" onclick="toggleTheme()" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåô</button>
</body>
</html>
